<!DOCTYPE html>
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"
      lang="" hola_ext_inject="disabled">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Lineup and Rumours</title>
    <meta name="description" content="Festival lineup finder, festival rumour finder">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/festival.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="./index_files/jquery.min.js"></script>
    <style type="text/css"></style>
    <style>
        .boxed {
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            width: 45%;
            padding: 10px;
            padding-left: 30px;
        }
        .boxed-alert {
            background-color: rgba(51, 204, 204, 0.8);
            border-radius: 15px;
            padding: 10px;
            width: 45%;
            padding-left: 30px;
        }

        .width5 {
            width: 35%;
            min-width: 300px;
        }

        .width51 {
            width: 35%;
            margin-top: 15px;
            min-width: 300px;
        }
        .width510 {
            width: 45%;
            margin-top: 15px;
            min-width: 318px;
        }

        .width52 {
            width: 30%;
            margin-top: 15px;
            min-width: 300px;
        }

        .top150 {
            margin-top: 38px;
        }


    </style>
    <script src="./index_files/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="css/bootstrap.icon-large.min.css" rel="stylesheet">
    <link href="css/tribal-timetable.css" rel="stylesheet">
    <script type="text/javascript" async="" src="js/ga.js"></script>
    <script type="text/javascript" src="js/jquery.ba-resize.js"></script>
    <script type="text/javascript" src="js/bootstrap-tooltip.js"></script>
</head>
<body class="homepage">

<header id="header">
    <nav class="navbar navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span
                        class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span
                        class="icon-bar"></span> <span class="icon-bar"></span></button>
                <a class="navbar-brand" href="index.html"><i><img src="images/green.png" height="50ex"></i> Welly
                    Splosher</a></a> </div>
            <div class="collapse navbar-collapse navbar-right">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="lineup.html">Lineup and Rumours</a></li>
                    <li><a href="schedule.html">Personalised Schedule</a></li>
                </ul>
            </div>
        </div>
    </nav>

</header>
<div class="color-border"></div>
<div class="jumbotron">
    <div class="container">
        <h1>Last.FM to Spotify Migration Tool</h1>

        <p>Create Playlists from your Last.FM top tracks</p>
    </div>
</div>

<div class="container">

    <div class="boxed-alert">
        <div class="row  top15 width510" id="spotifyauthdiv">
            <label for="authspotify">Authorise Spotify to access your account:</label>

            <div class="input-group input-group-lg btn-group-lg" style="width:95%;">
                <span class="input-group-addon">
                    <i id="spotifyauthindno" class="fa fa-close fa-lg" style="color:#d51007"></i>
                    <i id="spotifyauthindyes" class="fa fa-check fa-lg" style="color:green"></i>
                </span>

                <button type="button" class="btn btn-success" onclick="authWithSpotify()" style="width:100%;"
                        id="authspotify"><i
                        class="fa fa-spotify fa-lg"></i> Connect with Spotify
                </button>
            <span id="spinner" class="input-group-addon"><span
                    class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></span>
            </div>
        </div>

        <div class="row width5 top15 text-left" id="listeneddiv">
            <label for="lastfmid">Last FM Username:</label>

            <div class="input-group input-group-lg">
                <span class="input-group-addon"><i class="fa fa-lastfm-square fa-lg" style="color:#d51007"></i></span>

                <input type="text" class="form-control input-lg" placeholder="Last FM ID" id="lastfmid">
            </div>
        </div>


        <div class="row top15 width52">
            <label for="limitsel">How many tracks to include in playlist / How many artists to follow:</label>
            <select class="form-control input-lg" id="limitsel">
                <option>50</option>
                <option>100</option>
                <option>200</option>
                <option>300</option>
                <option>400</option>
                <option>500</option>
                <option>600</option>
                <option>750</option>
                <option>1000</option>
            </select>
        </div>

        <div class="row top15 width52">
            <label for="periodsel">Over what time period should your top tracks come from:</label>
            <select class="form-control input-lg" id="periodsel">
                <option>overall</option>
                <option>12month</option>
                <option>6month</option>
                <option>3month</option>
                <option>1month</option>
                <option>7day</option>
            </select>
        </div>



    </div>

    <div class="boxed top150" style="min-width:400px;">
        <div class="row  width510" id="gobuttondiv" style="min-width:390px;">
            <div class="input-group input-group-lg btn-group-lg" style="width:95%;">
                <button type="button" class="btn btn-success" onclick="go('toptracks')" style="width:100%; margin-bottom: 10px"><i
                        class="fa fa-spotify fa-lg"></i> Create Playlist
                </button>
                <button type="button" class="btn btn-success" onclick="go('followartists')" style="width:100%;"><i
                        class="fa fa-spotify fa-lg"></i> Follow Artists
                </button>
            </div>
        </div>
    </div>


    <div class="container">
        <div id="message"></div>
    </div>


    <!--<div class="row">-->
    <!--<table id="results" class="table table-striped"></table>-->
    <!--</div>-->
    <script>
        $(document).ready(function () {
            $('#spinner').hide();

            if (isTokenValid(getCode())) {
                $('#spotifyauthindyes').show();
                $('#spotifyauthindno').hide();
            }
            else {
                $('#spotifyauthindno').show();
                $('#spotifyauthindyes').hide();
            }
        });

        function go(method) {
            $('#spinner').show();
            // var host = 'http://spotifylastfm.cloudapp.net:80';
            var host = 'http://localhost:8080';

            var code = getCode();
            if (!isTokenValid(code)) {
                displayError('Invalid Token - Please reconnect with Spotify');
                return;
            }
            var username = $('#lastfmid').val();
            var limit = $('#limitsel').val();
            var period = $('#periodsel').val();
            var redirect = encodeURIComponent('http://www.wellysplosher.com/migrator.html');
            var url = host + '/' + method + '/' + limit + '/' + period + '/' + username + '/' + code + '/' + redirect;

            $.ajax({
                url: url,
                dataType: 'JSON',
                type: 'GET',
                success: function (json) {
                    $('#spinner').hide();
                    displayError('Done!');
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    displayError("An Error occured, please try again later");
                    $('#spinner').hide();
                }
            });
        }

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        function getCode() {
            return getParameterByName('code');
        }

        function isTokenValid(token) {
            if (token == null || token == '') {
                return false;
            }
            return true;
        }

        function displayError(message) {
            $('#message').html(message);
            $('#message').show();
            $('#spinner').hide();
        }

        function authWithSpotify() {
            var origin = window.location.origin;
            var pathname = window.location.pathname;
            var url = encodeURIComponent('http://www.wellysplosher.com/migrator.html');
            //var url = 'http://www.wellysplosher.com/schedule.html?source=spotify';
            window.location.replace('https://accounts.spotify.com/authorize/?client_id=4f9ea44544be4b789e54bfd9c23ebdc9&response_type=code&scope=user-read-private%20user-read-email%20user-library-read%20playlist-modify-public%20playlist-modify-private%20playlist-read-private%20user-follow-modify&redirect_uri=' + url);
        }


    </script>
    <script src="js/main.js"></script>

    <hr>

</div>


</body>
</html>